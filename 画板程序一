
local UI = loadstring(game:HttpGet("https://raw.githubusercontent.com/kkaaccnnbb/Logan/refs/heads/main/uiilb"))()

local win = UI:new("Virtual")

local uiTab1 = win:Tab("木材", '4483345998')

-- 整理功能相关变量定义（新增stopSort变量控制停止）
local bai = {
    dxmz = "",  -- 物品名称
    zlwjia = "",  -- 目标玩家名称
    zix = 1,  -- X轴参数
    zlz = 3,  -- Z轴参数
    dropdown = {},  -- 玩家列表
    stopSort = false  -- 停止标志位
}

-- 定义必要变量
local lp = game.Players.LocalPlayer
local mouse = lp:GetMouse()

-- 刷新玩家列表函数
function shuaxinlb(zji)
    bai.dropdown = {}
    for _, plr in ipairs(game.Players:GetChildren()) do
        if zji or plr ~= lp then
            table.insert(bai.dropdown, plr.Name)
        end
    end
end
shuaxinlb(true)

-- 创建整理功能UI
local sortSection = uiTab1:section("整理", false)

-- 玩家选择下拉框
local playerDropdown = sortSection:Dropdown("选择玩家", 'Dropdown', bai.dropdown, function(v)
    bai.zlwjia = v
end)

-- 重置玩家列表按钮
sortSection:Button("重置玩家名称", function()
    shuaxinlb(true)
    playerDropdown:SetOptions(bai.dropdown)
end)

-- X轴/Z轴输入框
sortSection:Textbox("x轴", 'TextBoxfalg', "输入数字", function(txt)
    bai.zix = tonumber(txt) or 1
end)
sortSection:Textbox("z轴", 'TextBoxfalg', "输入数字", function(txt)
    bai.zlz = tonumber(txt) or 3
end)

-- 【新增】停止整理按钮
sortSection:Button("停止整理", function()
    bai.stopSort = true  -- 触发停止标志
    notify("提示", "已停止整理操作", 3)
end)

-- 【关键修改】修正tp函数：仅移动物品，不移动玩家
local function tp(itemPart, targetCFrame)
    -- 传入物品的部件（如item.Main）和目标位置，仅移动该物品
    if itemPart and itemPart:IsA("BasePart") then
        itemPart.CFrame = targetCFrame  -- 只修改物品的位置
    end
end

-- 通知函数
local function notify(title, content, duration)
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = title,
        Text = content,
        Duration = duration or 5
    })
end

-- 获取整理工具按钮（核心功能，添加停止判断）
sortSection:Button("获取整理工具", function()
    bai.stopSort = false  -- 重置停止标志
    local tool = Instance.new("Tool")
    tool.RequiresHandle = false
    tool.Name = "点击要整理的物品"
    tool.Activated:Connect(function()
        if not lp.Character or not lp.Character:FindFirstChild("HumanoidRootPart") then
            notify("错误", "角色未加载", 3)
            return
        end
        
        local rootPos = lp.Character.HumanoidRootPart.Position
        local basePos = rootPos - Vector3.new(0, 4, 0)
        local items = {}
        
        -- 处理箱装物品
        if mouse.Target and mouse.Target.Parent:FindFirstChild("PurchasedBoxItemName") then
            local itemName = mouse.Target.Parent.PurchasedBoxItemName.Value
            bai.dxmz = itemName
            
            local function stackItems(ItemType, XAxis, ZAxis)
                for _, model in ipairs(game.Workspace.PlayerModels:GetChildren()) do
                    -- 【新增】检查是否需要停止
                    if bai.stopSort then 
                        notify("提示", "整理已中断", 3)
                        return 
                    end
                    
                    if model:FindFirstChild("Owner") and tostring(model.Owner.Value) == bai.zlwjia
                        and model:FindFirstChild("PurchasedBoxItemName") 
                        and tostring(model.PurchasedBoxItemName.Value) == ItemType then
                        table.insert(items, model)
                    end
                end
                
                local count = 0
                local totalPerLayer = XAxis * ZAxis
                local layers = math.ceil(#items / totalPerLayer)
                
                for Y = 1, layers do
                    -- 【新增】每层循环都检查停止标志
                    if bai.stopSort then break end
                    
                    for X = 1, XAxis do
                        if bai.stopSort then break end
                        
                        for Z = 1, ZAxis do
                            if bai.stopSort then break end
                            
                            count += 1
                            if count > #items then break end
                            
                            local item = items[count]
                            if not item:FindFirstChild("Main") then continue end
                            
                            tp(item.Main, item.Main.CFrame + Vector3.new(3, 0, 3))
                            
                            for _ = 1, 20 do
                                -- 【新增】移动过程中检查停止
                                if bai.stopSort then break end
                                
                                game.ReplicatedStorage.Interaction.ClientIsDragging:FireServer(item,"Ifyouarereadingthisstophackingbrolegitalsokrnlisbadbtw432rewdWdwFe432432rwDWDAVWdawgdGWAYDFGYTUW")
                                item.Main.CFrame = CFrame.new(
                                    X * item.Main.Size.X,
                                    Y * item.Main.Size.Y,
                                    Z * item.Main.Size.Z
                                ) + basePos
                                game.ReplicatedStorage.Interaction.ClientIsDragging:FireServer(item,"Ifyouarereadingthisstophackingbrolegitalsokrnlisbadbtw432rewdWdwFe432432rwDWDAVWdawgdGWAYDFGYTUW")
                                game:GetService("RunService").Stepped:Wait()
                            end
                        end
                    end
                end
            end
            
            stackItems(bai.dxmz, bai.zlz, bai.zix)
            if not bai.stopSort then  -- 只有未停止时才显示成功
                notify("成功", "已整理：" .. itemName, 5)
            end
        
        -- 处理普通物品（同样添加停止判断）
        elseif mouse.Target and mouse.Target.Parent:FindFirstChild("ItemName") then
            local itemName = mouse.Target.Parent.ItemName.Value
            bai.dxmz = itemName
            basePos = rootPos - Vector3.new(0, 5.5, 0)
            
            local function stackNormalItems(ItemType, XAxis, ZAxis)
                for _, model in ipairs(game.Workspace.PlayerModels:GetChildren()) do
                    if bai.stopSort then 
                        notify("提示", "整理已中断", 3)
                        return 
                    end
                    
                    if model:FindFirstChild("Owner") and tostring(model.Owner.Value) == bai.zlwjia
                        and model:FindFirstChild("DraggableItem") 
                        and tostring(model.DraggableItem.Parent) == ItemType then
                        table.insert(items, model)
                    end
                end
                
                local count = 0
                local totalPerLayer = XAxis * ZAxis
                local layers = math.ceil(#items / totalPerLayer)
                
                for Y = 1, layers do
                    if bai.stopSort then break end
                    
                    for X = 1, XAxis do
                        if bai.stopSort then break end
                        
                        for Z = 1, ZAxis do
                            if bai.stopSort then break end
                            
                            count += 1
                            if count > #items then break end
                            
                            local item = items[count]
                            if not item:FindFirstChild("Main") then continue end
                            
                            tp(item.Main, item.Main.CFrame + Vector3.new(3, 0, 3))
                            
                            for _ = 1, 20 do
                                if bai.stopSort then break end
                                
                                game.ReplicatedStorage.Interaction.ClientIsDragging:FireServer(item,"Ifyouarereadingthisstophackingbrolegitalsokrnlisbadbtw432rewdWdwFe432432rwDWDAVWdawgdGWAYDFGYTUW")
                                item.Main.CFrame = CFrame.new(
                                    X * item.Main.Size.X,
                                    Y * item.Main.Size.Y,
                                    Z * item.Main.Size.Z
                                ) + basePos
                                game.ReplicatedStorage.Interaction.ClientIsDragging:FireServer(item,"Ifyouarereadingthisstophackingbrolegitalsokrnlisbadbtw432rewdWdwFe432432rwDWDAVWdawgdGWAYDFGYTUW")
                                game:GetService("RunService").Stepped:Wait()
                            end
                        end
                    end
                end
            end
            
            stackNormalItems(bai.dxmz, bai.zlz, bai.zix)
            if not bai.stopSort then
                notify("成功", "已整理：" .. itemName, 5)
            end
        
        else
            notify("提示", "请点击带有物品名称的对象", 3)
        end
    end)
    
    tool.Parent = lp.Backpack
    notify("提示", "整理工具已放入背包", 3)
end)



local section = uiTab1:section("更改画板", true)

-- 用于存储输入的ID
local inputId = ""

-- 文本输入框
section:Textbox("请输入图片ID", 'TextBoxfalg', " ", function(txt)
    inputId = txt
    section:Notify("已输入ID: " .. (txt ~= "" and txt or "无"), "info")
end)

-- 更改按钮
section:Button("更改画板", function()
    if inputId == "" then
        section:Notify("请先输入图片ID", "error")
        return
    end
    
    local count = 0
    for _, v in pairs(workspace.PlayerModels:GetDescendants()) do
        if v.Name == "SetDECAL" then
            v:FireServer(inputId)
            count = count + 1
        end
    end
    
    if count > 0 then
        section:Notify("成功更改 " .. count .. " 个画板", "success")
    else
        section:Notify("未找到可更改的画板对象", "warning")
    end
end)

-- 代码标签与复制按钮（仅保留合理内容）

section:Button("复制黑帮大佬图片代码", function()
    local code = "93919985577380"
    setclipboard(code)  -- 复制到剪贴板
end)


section:Button("复制art裸身照图片代码", function()
    local code = "78189710379333"
    setclipboard(code)  -- 复制到剪贴板
end)

-- 显示窗口
win:Show()

